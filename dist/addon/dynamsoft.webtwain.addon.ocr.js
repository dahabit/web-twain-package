/*
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2017, Dynamsoft Corporation 
* Author: Dynamsoft R&D Department
*
* Version: 13.2
*
* Module: addon/ocr
* final js: build\addon\dynamsoft.webtwain.addon.OCR.js
*/
Dynamsoft.OCRVersion="9, 3, 2, 407";Dynamsoft.OCRLanguageData_eng="3112137";Dynamsoft.OCRLanguageData_ara="6309168";(function(a){function b(){var c=this;c._text="";c._fontName="";c._fontSize="";c._left=0;c._top=0;c._right=0;c._bottom=0}b.prototype.GetText=function(){var c=this;return c._text};b.prototype.GetFontName=function(){var c=this;return c._fontName};b.prototype.GetFontSize=function(){var c=this;return c._fontSize};b.prototype.GetWordRect=function(){var c=this;return c._left+","+c._top+","+c._right+","+c._bottom};a.NewWordBasicResult=function(){return new b()}})(Dynamsoft.Lib);(function(a){function b(){var c=this;c._count=0;c._left=0;c._top=0;c._right=0;c._bottom=0;c._wordlist=[]}b.prototype.GetWordCount=function(){var c=this;return c._count};b.prototype.GetLineRect=function(){var c=this;return c._left+","+c._top+","+c._right+","+c._bottom};b.prototype.GetWordContent=function(d){var f=this,c=f._wordlist.length;if(f._errorCode<0){return""}if(d==null||d>=c||d<0){Dynamsoft.Lib.Errors.OCR_InvalidIndex(f,"GetWordContent");return""}var e=Dynamsoft.Lib.NewWordBasicResult();e._text=f._wordlist[d].text;e._fontName=f._wordlist[d].fontname;e._fontSize=f._wordlist[d].fontsize;e._left=f._wordlist[d].rect[0];e._top=f._wordlist[d].rect[1];e._right=f._wordlist[d].rect[2];e._bottom=f._wordlist[d].rect[3];return e};a.NewLineBasicResult=function(){return new b()}})(Dynamsoft.Lib);(function(b){function a(){var c=this;c._count=0;c._linelist=[]}a.prototype.GetLineCount=function(){var c=this;return c._count};a.prototype.GetLineContent=function(e){var f=this,d=f._linelist.length;if(f._errorCode<0){return""}if(e==null||e>=d||e<0){Dynamsoft.Lib.Errors.OCR_InvalidIndex(f,"GetLineContent");return""}var c=Dynamsoft.Lib.NewLineBasicResult();c._count=f._linelist[e].words.length;c._left=f._linelist[e].rect[0];c._top=f._linelist[e].rect[1];c._right=f._linelist[e].rect[2];c._bottom=f._linelist[e].rect[3];c._wordlist=f._linelist[e].words;return c};b.NewPageBasicResult=function(){return new a()}})(Dynamsoft.Lib);(function(b){function a(){var c=this;c._count=0;c._pagelist=[]}a.prototype.GetPageCount=function(){var c=this;return c._count};a.prototype.GetPageContent=function(d){var f=this,c=f._pagelist.length;if(f._errorCode<0){return""}if(d==null||d>=c||d<0){Dynamsoft.Lib.Errors.OCR_InvalidIndex(f,"GetPageContent");return""}var e=Dynamsoft.Lib.NewPageBasicResult();e._count=f._pagelist[d].lines.length;e._linelist=f._pagelist[d].lines;return e};b.NewPageSetBasicResult=function(){return new a()}})(Dynamsoft.Lib);(function(b){function a(d){var c=this;c._errorCode=0;c._errorString="";c._resultlist=[];c._stwain=d}a.prototype.GetErrorCode=function(){var c=this;return c._errorCode};a.prototype.GetErrorString=function(){var c=this;return c._errorString};a.prototype.GetFormat=function(){var c=this;return c._resultlist[0].format};a.prototype.GetInput=function(){var c=this;return c._resultlist[0].input};a.prototype.GetPageSetCount=function(){var c=this;return c._resultlist[0].pagesets.length};a.prototype.GetPageSetContent=function(e){var f=this,c=f._resultlist[0].pagesets.length;if(f._errorCode<0){return""}if(e==null||e>=c||e<0){Dynamsoft.Lib.Errors.OCR_InvalidIndex(f,"GetPageSetContent");return""}var d=Dynamsoft.Lib.NewPageSetBasicResult();d._count=f._resultlist[0].pagesets[e].pages.length;d._pagelist=f._resultlist[0].pagesets[e].pages;return d};a.prototype.Get=function(){var c=this;return c._stwain._innerFun("GetOCRRestult")};a.prototype.Save=function(c){var e=this,d=b.html5.Funs.replaceLocalFilename(c);return e._stwain._innerFun("SaveOCRRestult",b.html5.Funs.makeParams(d))};b.NewOCRBasicResult=function(c){return new a(c)}})(Dynamsoft.Lib);var EnumDWT_OCRLanguage={OCRL_ENG:"eng",OCRL_ARA:"ara"};var EnumDWT_OCRPageSetMode={OCRPSM_OSD_ONLY:0,PSM_AUTO_OSD:1,PSM_AUTO_ONLY:2,PSM_AUTO:3,PSM_SINGLE_COLUMN:4,PSM_SINGLE_BLOCK_VERT_TEXT:5,PSM_SINGLE_BLOCK:6,PSM_SINGLE_LINE:7,PSM_SINGLE_WORD:8,PSM_CIRCLE_WORD:9,PSM_SINGLE_CHAR:10};var EnumDWT_OCROutputFormat={OCROF_TEXT:0,OCROF_PDFPLAINTEXT:1,OCROF_PDFIMAGEOVERTEXT:2,OCROF_PDFPLAINTEXT_PDFX:3,OCROF_PDFIMAGEOVERTEXT_PDFX:4};(function(b){function a(){var c=this;c.UnicodeFontName="";c.UseDetectedFont=true;c.MinFontSizeforMoreAccurateResult=0;c.OCRLanguage=EnumDWT_OCRLanguage.OCRL_ENG;c.PageSetMode=EnumDWT_OCRPageSetMode.PSM_AUTO;c.OutputFormat=EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT}a.prototype.GetUnicodeFontName=function(){var c=this;return c.UnicodeFontName};a.prototype.SetUnicodeFontName=function(c){var d=this;d.UnicodeFontName=c;return true};a.prototype.GetUseDetectedFont=function(){var c=this;return c.UseDetectedFont};a.prototype.SetUseDetectedFont=function(c){var d=this;d.UseDetectedFont=c;return true};a.prototype.GetMinFontSizeforMoreAccurateResult=function(){var c=this;return c.MinFontSizeforMoreAccurateResult};a.prototype.SetMinFontSizeforMoreAccurateResult=function(c){var d=this;d.MinFontSizeforMoreAccurateResult=c;return true};a.prototype.GetOCRLanguage=function(){var c=this;return c.OCRLanguage};a.prototype.SetOCRLanguage=function(c){var d=this;d.OCRLanguage=c;return true};a.prototype.GetPageSetMode=function(){var c=this;return c.PageSetMode};a.prototype.SetPageSetMode=function(c){var d=this;d.PageSetMode=c;return true};a.prototype.GetOutputFormat=function(){var c=this;return c.OutputFormat};a.prototype.SetOutputFormat=function(c){var d=this;d.OutputFormat=c;return true};b.NewOptions=function(){return new a()}})(Dynamsoft.Lib);var EnumDWT_OCRDownloadType={OCRDT_Dll:0,OCRDT_LANGUAGE:1};(function(a){if(!a.product.bChromeEdition){return}function c(d){var e=a.html5.Funs;d.__innerOCRBasicReadFunction=function(j,s,k,o,i,q,r,f,g,n,h){var l=this;if(!a.isFunction(n)){return l.__innerOCRSyncReadFunction(j,g)}else{return l.__innerOCRBasicAsyncReadFunction(j,s,k,o,i,q,r,f,g,n,h)}};d.__innerGetOCRBasicResultAsyncFunction=function(g){var f=Dynamsoft.Lib.NewOCRBasicResult(this);if(g){f._errorCode=g.exception;f._errorString=g.description;f._resultlist=g.result}return f};d.__innerOCRBasicAsyncReadFunction=function(j,u,k,q,i,r,t,f,g,o,h){var n=this;var l=function(m){if(m.exception==0){if(a.isFunction(o)){if(u!=-1){if(q==1){o(u,i,r,t,f,n.__innerGetOCRBasicResultAsyncFunction(m))}else{o(u,n.__innerGetOCRBasicResultAsyncFunction(m))}}else{if(k!=""){o(k,n.__innerGetOCRBasicResultAsyncFunction(m))}else{o(n.__innerGetOCRBasicResultAsyncFunction(m))}}}}else{if(a.isFunction(h)){h(m.exception,m.description)}}e.hideMask(j)},s=function(m){e.hideMask(j)};e.showMask(j);n._innerSend(j,g,true,l,s);return true};d.__innerOCRSyncReadFunction=function(g,i){var j=this,h,f;h=j._innerFunRaw(g,i,false,false);f=a.NewOCRBasicResult();f._errorCode=j._errorCode;f._errorString=j._errorString;if(h&&a.isArray(h)){f._resultlist=h;f._Count=h.length}return f};d.__innerBasicDownload=function(m,o,h,r,i){var l=d,n;a.cancelFrome=2;m=m.toString();var k=function(){if(a.isFunction(r)){r()}return true},s=function(){if(a.isFunction(i)){i(l.ErrorCode,l.ErrorString)}return false};if(!e.checkProductKey(l,{Core:true})){return s()}if(!e.checkProductKey(l,{OCR:true},true)){return s()}var f="";if(o!=EnumDWT_OCRDownloadType.OCRDT_Dll){l._innerFun("SetOCRLanguage",e.makeParams(h))}f=l._innerFun("GetAddOnVersion",e.makeParams("ocr"));var g=f.split("|");if(o==EnumDWT_OCRDownloadType.OCRDT_Dll){if(g[0]==Dynamsoft.OCRVersion){k();return true}}else{if((h==EnumDWT_OCRLanguage.OCRL_ENG&&g[1]==Dynamsoft.OCRLanguageData_eng)||(h==EnumDWT_OCRLanguage.OCRL_ARA&&g[1]==Dynamsoft.OCRLanguageData_ara)){k();return true}}if(!m||m==""){a.Errors.OCR_InvalidRemoteFilename(l);s();return false}if(e.isServerInvalid(l)){s();return false}n="get";a.showProgress(l,"Download",true);var q=function(t){var u=(t.total===0)?100:Math.round(t.loaded*100/t.total),v=[t.loaded," / ",t.total].join("");l._OnPercentDone([0,u,"","http"])},j=true;if(o==EnumDWT_OCRDownloadType.OCRDT_Dll){l._OnPercentDone([0,-1,"Downloading OCR Module...","http"])}else{l._OnPercentDone([0,-1,"Downloading OCR Language Data...","http"])}if(!a.isFunction(r)){j=false}e.loadHttpBlob(l,n,m,j,function(p){l._OnPercentDone([0,-1,"Loading..."]);var u=100;if(o==EnumDWT_OCRDownloadType.OCRDT_LANGUAGE){u=101}l.__LoadImageFromBytes(p,u,"",j,k,s)},function(){a.closeProgress("Download");s()},q)}}var b=function(f){var g=a.html5.Funs,d;var e=a.NewOptions();c(f);d={OCR:{SetUnicodeFontName:function(h){return e.SetUnicodeFontName(h)},GetUnicodeFontName:function(){return e.GetUnicodeFontName()},SetIfUseDetectedFont:function(h){return e.SetUseDetectedFont(h)},GetIfUseDetectedFont:function(){return e.GetUseDetectedFont()},SetMinFontSizeforMoreAccurateResult:function(h){return e.SetMinFontSizeforMoreAccurateResult(h)},GetMinFontSizeforMoreAccurateResult:function(){return e.GetMinFontSizeforMoreAccurateResult()},SetLanguage:function(h){return e.SetOCRLanguage(h)},SetPageSetMode:function(i){var h=i*1;if(h==EnumDWT_OCRPageSetMode.OCRPSM_OSD_ONLY||h==EnumDWT_OCRPageSetMode.PSM_AUTO_OSD||h==EnumDWT_OCRPageSetMode.PSM_AUTO_ONLY||h==EnumDWT_OCRPageSetMode.PSM_AUTO||h==EnumDWT_OCRPageSetMode.PSM_SINGLE_COLUMN||h==EnumDWT_OCRPageSetMode.PSM_SINGLE_BLOCK_VERT_TEXT||h==EnumDWT_OCRPageSetMode.PSM_SINGLE_BLOCK||h==EnumDWT_OCRPageSetMode.PSM_SINGLE_LINE||h==EnumDWT_OCRPageSetMode.PSM_SINGLE_WORD||h==EnumDWT_OCRPageSetMode.PSM_CIRCLE_WORD||h==EnumDWT_OCRPageSetMode.PSM_SINGLE_CHAR){return e.SetPageSetMode(h)}Dynamsoft.Lib.Errors.OCR_InvalidPageSetMode(f);return false},SetOutputFormat:function(i){var h=i*1;if(h==EnumDWT_OCROutputFormat.OCROF_TEXT||h==EnumDWT_OCROutputFormat.OCROF_PDFPLAINTEXT||h==EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT||h==EnumDWT_OCROutputFormat.OCROF_PDFPLAINTEXT_PDFX||h==EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT_PDFX){return e.SetOutputFormat(h)}Dynamsoft.Lib.Errors.OCR_InvalidOutputFormat(f);return false},Recognize:function(j,h,i){if(!g.checkProductKey(f,{OCR:true},true)){if(a.isFunction(i)){i(f._errorCode,f._errorString)}return false}return f.__innerOCRBasicReadFunction("OCRRecognize",j,"",0,0,0,0,0,g.makeParams(0,j,"",0,0,0,0,e.GetUnicodeFontName(),e.GetUseDetectedFont(),e.GetMinFontSizeforMoreAccurateResult(),e.GetOCRLanguage(),e.GetPageSetMode(),e.GetOutputFormat()),h,i)},RecognizeRect:function(o,i,l,n,h,m,j){if((!i&&i!=0)||(!l&&l!=0)||(!n&&n!=0)||(!h&&h!=0)){var k=this;var p=Dynamsoft.Lib.NewOCRBasicResult(f);Dynamsoft.Lib.Errors.OCR_InvalidLeftOrTopOrRightOrBottom(p,"RecognizeRect");j(p.GetErrorCode(),p.GetErrorString());return}if(!g.checkProductKey(f,{OCR:true},true)){if(a.isFunction(j)){j(f._errorCode,f._errorString)}return false}return f.__innerOCRBasicReadFunction("OCRRecognize",o,"",1,i,l,n,h,g.makeParams(0,o,"",i,l,n,h,e.GetUnicodeFontName(),e.GetUseDetectedFont(),e.GetMinFontSizeforMoreAccurateResult(),e.GetOCRLanguage(),e.GetPageSetMode(),e.GetOutputFormat()),m,j)},RecognizeFile:function(i,h,j){var k=g.replaceLocalFilename(i);if(!g.checkProductKey(f,{OCR:true},true)){if(a.isFunction(j)){j(f._errorCode,f._errorString)}return false}return f.__innerOCRBasicReadFunction("OCRRecognize",-1,k,0,0,0,0,0,g.makeParams(1,-1,k,0,0,0,0,e.GetUnicodeFontName(),e.GetUseDetectedFont(),e.GetMinFontSizeforMoreAccurateResult(),e.GetOCRLanguage(),e.GetPageSetMode(),e.GetOutputFormat()),h,j)},RecognizeSelectedImages:function(h,j){var i;if(!g.checkProductKey(f,{OCR:true},true)){if(a.isFunction(j)){j(f._errorCode,f._errorString)}return false}i=g.__SetSelectedImages(f,f._UIManager.GetCurrentImageIndex(),f._UIManager.GetSelectedIndexes());if(i){i=f.__innerOCRBasicReadFunction("OCRRecognize",-1,"",0,0,0,0,0,g.makeParams(2,-1,"",0,0,0,0,e.GetUnicodeFontName(),e.GetUseDetectedFont(),e.GetMinFontSizeforMoreAccurateResult(),e.GetOCRLanguage(),e.GetPageSetMode(),e.GetOutputFormat()),h,j)}return i},Download:function(j,h,i){return f.__innerBasicDownload(j,EnumDWT_OCRDownloadType.OCRDT_Dll,e.GetOCRLanguage(),h,i)},DownloadLangData:function(j,h,i){return f.__innerBasicDownload(j,EnumDWT_OCRDownloadType.OCRDT_LANGUAGE,e.GetOCRLanguage(),h,i)}}};f.__addon=f.__addon||{};a.mix(f.__addon,d)};a.DynamicLoadAddonFuns.push(b)})(Dynamsoft.Lib);