/*
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2018, Dynamsoft Corporation 
* Author: Dynamsoft R&D Department
*
* Version: 14.3
*
* Module: addon/webcam
* final js: build\addon\dynamsoft.webtwain.addon.webcam.js
*/
Dynamsoft.WebcamVerForActiveX="14, 2, 0, 1022";Dynamsoft.WebcamVerInName="14.2.0.1022";var EnumDWT_VideoRotateMode={VRM_NONE:0,VRM_90_DEGREES_CLOCKWISE:1,VRM_180_DEGREES_CLOCKWISE:2,VRM_270_DEGREES_CLOCKWISE:3,VRM_FLIP_VERTICAL:4,VRM_FLIP_HORIZONTAL:5};var EnumDWT_VideoProperty={VP_BRIGHTNESS:0,VP_CONTRAST:1,VP_HUE:2,VP_SATURATION:3,VP_SHARPNESS:4,VP_GAMMA:5,VP_COLORENABLE:6,VP_WHITEBALANCE:7,VP_BACKLIGHTCOMPENSATION:8,VP_GAIN:9};var EnumDWT_CameraControlProperty={CCP_PAN:0,CCP_TILT:1,CCP_ROLL:2,CCP_ZOOM:3,CCP_EXPOSURE:4,CCP_IRIS:5,CCP_FOCUS:6};(function(a){function b(){var c=this;c._errorCode=0;c._errorString="";c._Count=0;c._resultlist=[]}b.prototype.GetCount=function(){var c=this;return c._Count-1};b.prototype.Get=function(d){var e=this,c=e._resultlist.length;if(e._errorCode<0){return""}if(d>=c-1||d<0){Dynamsoft.Lib.Errors.Webcam_InvalidIndex(e,"Get");return""}return e._resultlist[d]};b.prototype.GetCurrent=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[c-1]};a.NewWebcamValue=function(){return new b()}})(Dynamsoft.Lib);(function(a){function b(){var c=this;c._errorCode=0;c._errorString="";c._Count=0;c._resultlist=[]}b.prototype.GetValue=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].current};b.prototype.GetIfAuto=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].auto=="true"?true:false};a.NewWebcamSetting=function(){return new b()}})(Dynamsoft.Lib);(function(a){function b(){var c=this;c._errorCode=0;c._errorString="";c._Count=0;c._resultlist=[]}b.prototype.GetMinValue=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].min};b.prototype.GetMaxValue=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].max};b.prototype.GetSteppingDelta=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].step};b.prototype.GetDefaultValue=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].defaultValue};b.prototype.GetIfAuto=function(){var d=this,c=d._resultlist.length;if(d._errorCode<0){return""}return d._resultlist[0].auto=="true"?true:false};a.NewWebcamMoreSetting=function(){return new b()}})(Dynamsoft.Lib);(function(a){var b=function(c){var d=a.html5.Funs;c._innerSetWebcamValue=function(f){var g=this,e;e=a.NewWebcamValue();e._errorCode=g._errorCode;e._errorString=g._errorString;if(f&&a.isArray(f)){e._resultlist=f;e._Count=f.length}return e};c._innerSetWebcamSetting=function(f){var g=this,e;e=a.NewWebcamSetting();e._errorCode=g._errorCode;e._errorString=g._errorString;if(f&&a.isArray(f)){e._resultlist=f;e._Count=f.length}return e};c._innerSetWebcamMoreSetting=function(f){var g=this,e;e=a.NewWebcamMoreSetting();e._errorCode=g._errorCode;e._errorString=g._errorString;if(f&&a.isArray(f)){e._resultlist=f;e._Count=f.length}return e}};if(a.DynamicLoadAddonFuns){a.DynamicLoadAddonFuns.push(b)}a.Addon_Events.push("OnFrameCaptured");a.Addon_Events.push("OnCaptureSuccess");a.Addon_Events.push("OnCaptureError");a.Addon_Sendback_Events.push("OnCaptureSuccess");a.Addon_Sendback_Events.push("OnCaptureError");a.WebcamErrors={InvalidParameter:function(c){c._errorCode=-10001;c._errorString="The parameter is invalid."}}})(Dynamsoft.Lib);(function(b){if(!b.product.bChromeEdition){return}var a;function c(f){var g=b.html5.Funs;if(b.env.bMac){a="DynamicWebcam.dylib"}else{if(b.env.bLinux){a="DynamicWebcam.so"}else{if(dynamsoft.dcp.b64bit){a="DynamicWebcamx64.dll"}else{a="DynamicWebcam.dll"}}}f._innerWebcamValueFunction=function(h,j){var k=this,i;i=k._innerFunRaw(h,j,false,false);return k._innerSetWebcamValue(i)};f._innerWebcamSettingFunction=function(h,j){var k=this,i;i=k._innerFunRaw(h,j,false,false);return k._innerSetWebcamSetting(i)};f._innerWebcamMoreSettingFunction=function(h,j){var k=this,i;i=k._innerFunRaw(h,j,false,false);return k._innerSetWebcamMoreSetting(i)};f._OnCaptureSuccess=function(h){var i=this;console.log("webcam event: OnCaptureSuccess");if(Dynamsoft.Lib.isFunction(i.__OnCaptureSuccess)){i.__OnCaptureSuccess()}};f._OnCaptureError=function(i){var k=this,h=i[1],j=i[2];console.log("webcam event: OnCaptureError");if(Dynamsoft.Lib.isFunction(k.__OnCaptureError)){k.__OnCaptureError(h,j)}};f._OnFrameCaptured=function(j){var o=this,m=Dynamsoft.Lib,n=o.__PlayVideoId;if(m.isString(n)&&n!=""&&!o.__videoLoading&&!o.__videoPause){var h=m.one("#"+n),k=o.__videoQuality;if(h&&h.length>0){var i=h.getEL().children[0];try{if(!k){k=60}i.src=o.GetImageURL(-1,-1,-1,0,k);o.__videoLoading=true;i.onload=function(){o.__videoLoading=false;i.onload=null;i.onerror=null};i.onerror=function(){o.__videoLoading=false;i.onload=null;i.onerror=null}}catch(l){o.__videoLoading=false;i.onload=null;i.onerror=null}}}if(m.isFunction(o.__OnFrameCaptured)){o.__OnFrameCaptured(j)}}}function d(g,h){var f=h.length-1;while(f>=0&&h[f].p1>=g.p1){if(h[f].p1==g.p1&&h[f].p2<g.p2){break}h[f+1]=h[f];f--}h[f+1]=g}var e=function(g){var h=b.html5.Funs,f;c(g);f={Webcam:{Download:function(n,q,j){var m=g,o;Dynamsoft.Lib.cancelFrome=2;var l=function(){if(Dynamsoft.Lib.isFunction(q)){q()}return true},r=function(){if(Dynamsoft.Lib.isFunction(j)){j(m.ErrorCode,m.ErrorString)}return false};if(!h.checkProductKey(m,{Core:true})){return r()}if(!h.checkProductKey(m,{Webcam:true},true)){return r()}var i=g._innerFun("GetAddOnVersion",h.makeParams("webcam",a));if(i!=""){l();return true}if(!n||n==""){Dynamsoft.Lib.Errors.Webcam_InvalidRemoteFilename(m);r();return false}if(h.isServerInvalid(m)){r();return false}o="get";Dynamsoft.Lib.showProgress(m,"Download",true);var p=function(s){var t=(s.total===0)?100:Math.round(s.loaded*100/s.total),u=[s.loaded," / ",s.total].join("");m._OnPercentDone([0,t,"","http"])},k=true;m._OnPercentDone([0,-1,"Downloading Webcam Module...","http"]);if(!Dynamsoft.Lib.isFunction(q)){k=false}return h.loadHttpBlob(m,o,n,k,function(s){m._OnPercentDone([0,-1,"Loading..."]);var u=100;m.__LoadImageFromBytes(s,u,"",k,l,r)},function(){Dynamsoft.Lib.closeProgress("Download");r()},p)},GetSourceList:function(){var i=g._innerFunRaw("GetWebcamSourceList");if(g.ErrorCode==0){i.splice(i.length-1,1)}return i},SelectSource:function(i){return g._innerFun("SelectWebcam",h.makeParams(i))},CloseSource:function(){return g._innerFun("StopCapture")},GetImagePartUrl:function(){return g.GetImageURL(-1,-1,-1,!0,g.__videoQuality)},GetImageUrl:function(){return g.GetImageURL(-1,-1,-1,0,g.__videoQuality)},PlayVideo:function(q,s,m,x,l){var v,o=Dynamsoft.Lib,E=60,p=false;if(!q){Dynamsoft.Lib.Errors.ParameterCannotEmpty(g);return false}if(!h.checkProductKey(g,{Core:true},true)){return false}if(!h.checkProductKey(g,{Webcam:true},true)){return false}var t=q._strDWTControlContainerID;var B=dynamsoft.lib.one("#"+t),D;if(B&&B.length>0){D=dynamsoft.lib.one(".dynamsoft-dwt-container-box",B)}if(D&&D.length>0){var k=D.getEL(),A;for(A=0;A<k.children.length;A++){k.children[A].style.display="none"}if(k.children.length>1){v=k.children[k.children.length-1].id;k.children[k.children.length-1].style.display=""}if(!v||v==""){v="_dwtWebcam_VideoId_"+o.getRandom();var r=parseInt(q.Width),C=parseInt(q.Height);D.append('<div id="'+v+'" style="width:'+r+"px;height:"+C+'px;line-height:0;border: 1px solid #CCC;text-align: center;vertical-align: middle;display: table-cell;"><img style="width:'+(r-2)+"px;height:"+(C-2)+'px;" /></div>')}if(g.__PlayVideoId==v){p=true}else{var u=g.__PlayVideoId;if(!o.isString(u)||u==""){g.__PlayVideoId=v}else{var y=o.one("#"+u);if(y&&y.length>0){var n=y.parent().getEL(),z;for(z=0;z<n.children.length;z++){n.children[z].style.display=""}y.remove()}g.__PlayVideoId=v}}}else{o.WebcamErrors.InvalidParameter(g);return false}g.__videoLoading=false;if(o.isFunction(m)){g.__OnFrameCaptured=m}if(g.__videoPause){g.__videoPause=false;return true}g.__videoPause=false;if(s){E=1*s;if(E<1){E=60}g.__videoQuality=E;if(p){return true}}else{g.__videoQuality=E}return g._innerSend("PlayVideo",h.makeParams(true),true,x,l)},PauseVideo:function(){g.__videoPause=true},StopVideo:function(j,m){var o=Dynamsoft.Lib;g.__videoPause=false;g.__OnFrameCaptured=false;g.__videoLoading=false;g.__videoQuality=60;var p=g.__PlayVideoId;if(o.isString(p)&&p!=""){var k=o.one("#"+p);if(k&&k.length>0){var n=k.parent().getEL(),l;for(l=0;l<n.children.length;l++){n.children[l].style.display=""}k.remove()}}g.__PlayVideoId="";return g._innerSend("PlayVideo",h.makeParams(false,0),true,j,m)},CaptureImage:function(l,j){if(!h.checkProductKey(g,{Core:true},true)){if(b.isFunction(j)){j(g._errorCode,g._errorString)}return false}if(!h.checkProductKey(g,{Webcam:true},true)){if(b.isFunction(j)){j(g._errorCode,g._errorString)}return false}var o=g,i="CaptureImage",n=function(m){h.hideMask(i);if(b.isFunction(l)){l()}},k=function(m){h.hideMask(i);if(b.isFunction(j)){j(g._errorCode,g._errorString)}};h.showMask(i);o.__OnCaptureSuccess=n;o.__OnCaptureError=k;return o._innerSend(i,h.makeParams(false),true,false,false)},GetMediaType:function(){return g._innerWebcamValueFunction("GetMediaType")},SetMediaType:function(i){return g._innerFun("SetMediaType",h.makeParams(i))},GetResolution:function(){var j=g._innerWebcamValueFunction("GetResolution");if(j&&j._resultlist){var k,q,p=j._resultlist,n=[],r=[],m;if(p.length>0){m=p[p.length-1]}if(m==""&&p.length>0){m=p[0]}for(k=0;k<p.length-1;k++){q=p[k];var l=q.toLowerCase().split("x");d({value:q,p1:parseInt(l[0]),p2:parseInt(l[1])},n)}for(k=0;k<n.length;k++){q=n[k].value;r.push(q)}if(m){r.push(m)}j._resultlist=r;n=null;r=null}return j},SetResolution:function(i){return g._innerFun("SetResolution",h.makeParams(i))},GetFrameRate:function(){return g._innerWebcamValueFunction("GetFrameRate")},SetFrameRate:function(i){return g._innerFun("SetFrameRate",h.makeParams(i))},GetVideoPropertySetting:function(i){return g._innerWebcamSettingFunction("GetWebcamVideoPropertySetting",h.makeParams(i))},GetVideoPropertyMoreSetting:function(i){return g._innerWebcamMoreSettingFunction("GetWebcamVideoPropertyMoreSetting",h.makeParams(i))},SetVideoPropertySetting:function(j,i,k){return g._innerFun("SetWebcamVideoPropertySetting",h.makeParams(j,i,k))},SetVideoRotateMode:function(i){return g._innerFun("SetVideoRotateMode",h.makeParams(i))},GetCameraControlPropertySetting:function(i){return g._innerWebcamSettingFunction("GetWebcamCameraControlSetting",h.makeParams(i))},GetCameraControlPropertyMoreSetting:function(i){return g._innerWebcamMoreSettingFunction("GetWebcamCameraControlMoreSetting",h.makeParams(i))},SetCameraControlPropertySetting:function(j,i,k){return g._innerFun("SetWebcamCameraControlPropertySetting",h.makeParams(j,i,k))}}};g.__addon=g.__addon||{};b.mix(g.__addon,f)};if(b.DynamicLoadAddonFuns){b.DynamicLoadAddonFuns.push(e)}})(Dynamsoft.Lib);(function(a){if(!a.product.bPluginEdition&&!a.product.bActiveXEdition){return}function b(e){e._innerRead=function(g){var i=this,f;try{f=dynamsoft.lib.parse(g)}catch(h){}return f.result};e._innerWebcamValueFunctionPlugin=function(g){var h=this,f;f=h._innerRead(g);return h._innerSetWebcamValue(f)};e._innerWebcamSettingFunctionPlugin=function(g){var h=this,f;f=h._innerRead(g);return h._innerSetWebcamSetting(f)};e._innerWebcamMoreSettingFunctionPlugin=function(g){var h=this,f;f=h._innerRead(g);return h._innerSetWebcamMoreSetting(f)}}function c(f,g){var e=g.length-1;while(e>=0&&g[e].p1>=f.p1){if(g[e].p1==f.p1&&g[e].p2<f.p2){break}g[e+1]=g[e];e--}g[e+1]=f}var d=function(g){var f=false,h,e;b(g);if(g.getSWebTwain()&&g.getSWebTwain().Addon){f=true}if(!f){return false}h=g.getSWebTwain();e={Webcam:{Download:function(m,i,k){var l=h.GetAddOnVersion("webcam");if(l==Dynamsoft.WebcamVerForActiveX){if(Dynamsoft.Lib.isFunction(i)){i()}return true}var j=h.DownloadAddon(m);return a.wrapperRet(g,j,i,k)},GetSourceList:function(){var j=h.GetWebcamSourceList(),i=[];if(g.ErrorCode==0){i=g._innerRead(j);if(i&&i.length>1){i.splice(i.length-1,1)}}return i},SelectSource:function(i){return h.SelectWebcam(i)},CloseSource:function(){return h.StopCapture()},PlayVideo:function(l,k,i){if(!l||!l.getSWebTwain()){Dynamsoft.Lib.WebcamErrors.InvalidParameter(g);return false}var j=l.getSWebTwain().CurrentHWND;if(!j){Dynamsoft.Lib.WebcamErrors.InvalidParameter(g);return false}g._playVideoDWT=l;setTimeout(function(){h.RunWebcamCmd("PlayVideo",j,null,null,i)},100);return true},PauseVideo:function(){return true},StopVideo:function(){g._playVideoDWT=null;return h.RunWebcamCmd("StopVideo",0,null,null,null)},CaptureImage:function(j,i){return h.RunWebcamCmd("Capture",0,j,i,null)},GetMediaType:function(){return g._innerWebcamValueFunctionPlugin(h.GetMediaType())},SetMediaType:function(i){return h.SetMediaType(i)},GetResolution:function(){var j=g._innerWebcamValueFunctionPlugin(h.GetResolution());if(j&&j._resultlist){var k,q,p=j._resultlist,n=[],r=[],m;if(p.length>0){m=p[p.length-1]}for(k=0;k<p.length-1;k++){q=p[k];var l=q.toLowerCase().split("x");c({value:q,p1:parseInt(l[0]),p2:parseInt(l[1])},n)}for(k=0;k<n.length;k++){q=n[k].value;r.push(q)}if(m){r.push(m)}j._resultlist=r;n=null;r=null}return j},SetResolution:function(i){return h.SetResolution(i)},GetFrameRate:function(){return g._innerWebcamValueFunctionPlugin(h.GetFrameRate())},SetFrameRate:function(i){return h.SetFrameRate(i)},GetVideoPropertySetting:function(i){return g._innerWebcamSettingFunctionPlugin(h.GetWebcamVideoPropertySetting(i))},GetVideoPropertyMoreSetting:function(i){return g._innerWebcamMoreSettingFunctionPlugin(h.GetWebcamVideoPropertyMoreSetting(i))},SetVideoPropertySetting:function(j,i,k){return h.SetWebcamVideoPropertySetting(j,i,k)},SetVideoRotateMode:function(i){return h.SetVideoRotateMode(i)},GetCameraControlPropertySetting:function(i){return g._innerWebcamSettingFunctionPlugin(h.GetWebcamCameraControlSetting(i))},GetCameraControlPropertyMoreSetting:function(i){return g._innerWebcamMoreSettingFunctionPlugin(h.GetWebcamCameraControlMoreSetting(i))},SetCameraControlPropertySetting:function(j,i,k){return h.SetWebcamCameraControlPropertySetting(j,i,k)}}};g.Addon=g.Addon||{};a.mix(g.Addon,e)};if(a.DynamicLoadAddonFuns){a.DynamicLoadAddonFuns.push(d)}})(Dynamsoft.Lib);
