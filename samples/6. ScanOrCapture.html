<!DOCTYPE html>
<html>

<head>
    <title>Acquire Images From Scanners and Cameras</title>
    <script type="text/javascript" src="../dist/dynamsoft.webtwain.initiate.js"></script>
    <script type="text/javascript" src="../dist/dynamsoft.webtwain.config.js"></script>
    <script type="text/javascript" src="../dist/addon/dynamsoft.webtwain.addon.pdf.js"></script>
    <script type="text/javascript" src="../dist/addon/dynamsoft.camera.initiate.js"></script>
    <script type="text/javascript" src="../dist/addon/dynamsoft.camera.config.js"></script>
</head>

<body>
    <h1>Acquire Images From Scanners and Cameras</h1>
    <input type="button" value="Scan Documents" onclick="AcquireImage();" />
    <input type="button" value="Load Images or PDFs" onclick="LoadImages();" style="margin-right: 20px;" />
    <select id="sltCameraSource"></select>
    <input type="button" value="Play Video" onclick="playVideo();" />
    <input type="button" value="Grab An Image" onclick="grabImage();" />
    <br />
    <br />
    <div id="dwtcontrolContainer" style="float:left;"></div>
    <div id="image-container" style="float:left; position: absolute; left:-1000px;"> </div>
    <div id="video-container" style="float:left; margin-left: 20px; width:270px; height:350px; border:1px black solid"> </div>
    <script type="text/javascript">
        window.onload = function () {
            if (Dynamsoft && (!Dynamsoft.Lib.env.bWin)) {
                var ObjString = [];
                ObjString.push('<div class="p15">');
                ObjString.push("Please note that the webcam SDK currently only works on Windows.");
                ObjString.push('</div>');
                Dynamsoft.WebTwainEnv.ShowDialog(400, 180, ObjString.join(''));
                if (document.getElementsByClassName("dynamsoft-dialog-close"))
                    document.getElementsByClassName("dynamsoft-dialog-close")[0].style.display = "none";
            } else {
                if (!Dynamsoft.Lib.product.bChromeEdition) {
                    Dynamsoft.WebTwainEnv.Containers[0].Height = '1px;';
                    Dynamsoft.WebTwainEnv.Containers[0].Width = '1px;';
                }
                Dynamsoft.WebTwainEnv.Load();
            }
        };

        Dynamsoft.WebTwainEnv.AutoLoad = false;
        Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady); // Register OnWebTwainReady event. This event fires as soon as Dynamic Web TWAIN is initialized and ready to be used

        function Dynamsoft_OnReady() {
            DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); // Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'
            if (DWObject) {
                var pdfrInstallerPath = Dynamsoft.WebTwainEnv.ResourcesPath + '/addon/';
                if (Dynamsoft.Lib.env.bMac)
                    pdfrInstallerPath += 'MacPdf.zip';
                else if (Dynamsoft.Lib.env.bLinux)
                    pdfrInstallerPath += 'LinuxPdf.zip';
                else
                    pdfrInstallerPath += 'Pdf.zip';
                DWObject.Addon.PDF.Download(
                    pdfrInstallerPath,
                    function () {
                        /*console.log('The PDF Rasterizer dll is installed.');*/
                        dynamsoft.dcsEnv.init('video-container', 'image-container', onInitSuccess, onInitFailure);
                    },
                    function (errorCode, errorString) {
                        console.log(errorString);
                        console.log("The PDF Rasterizer wasn't installed correctly.");
                    }
                );

            }
        }
        function playVideo() {
            var selectedCameraName = document.getElementById('sltCameraSource').value;
            if (selectedCameraName) {
                dcsObject.camera.takeCameraOwnership(selectedCameraName);

                if (dcsObject.getErrorCode() !== EnumDCS_ErrorCode.OK) {
                    curCameraName = '';
                } else curCameraName = selectedCameraName;

                dcsObject.camera.playVideo();

            } else {
                curCameraName = '';
                console.log('No camera is connected.');
            }
        }

        function grabImage() {
            if (dcsObject) {
                dcsObject.camera.captureImage('image-container');
                if (dcsObject.getErrorCode() !== EnumDCS_ErrorCode.OK) {
                    alert('Capture error: ' + dcsObject.getErrorString());
                }
                else {
                    var count = imageViewer.image.getCount();
                    if (count > 0) {
                        imageViewer.io.copyToClipboard(count - 1);
                        DWObject.LoadDibFromClipboard()
                    }
                }
            }
        }

        function onInitSuccess(videoViewerId, imageViewerId) {
            setTimeout(function () {
                dcsObject = dynamsoft.dcsEnv.getObject(videoViewerId);
                imageViewer = dcsObject.getImageViewer(imageViewerId);
                imageViewer.ui.setSelectedImageBorderWidth(1);
                dcsObject.videoviewer.setMode(dcsObject.videoviewer.EnumMode.Image);
                var cameraList = dcsObject.camera.getCameraList();
                for (var i = 0; i < cameraList.length; i++)
                    document.getElementById("sltCameraSource").options.add(new Option(cameraList[i], cameraList[i]));
            }, 100);
        }

        function onInitFailure(errorCode, errorString) {
            console.log('Init failed: ' + errorString);
        }

        function AcquireImage() {
            if (DWObject) {
                DWObject.SelectSource(function () {
                    var OnAcquireImageSuccess, OnAcquireImageFailure;
                    OnAcquireImageSuccess = OnAcquireImageFailure = function () {
                        DWObject.CloseSource();
                    };
                    DWObject.OpenSource();
                    DWObject.IfDisableSourceAfterAcquire = true;
                    DWObject.AcquireImage(OnAcquireImageSuccess, OnAcquireImageFailure);
                }, function () {
                    console.log('SelectSource failed!');
                });
            }
        }

        function LoadImages() {
            if (DWObject) {
                if (DWObject.Addon && DWObject.Addon.PDF) {
                    DWObject.Addon.PDF.SetResolution(300);
                    DWObject.Addon.PDF.SetConvertMode(EnumDWT_ConvertMode.CM_RENDERALL);
                }
                DWObject.LoadImageEx('', 5,
                    function () {
                    },
                    function (errorCode, errorString) {
                        alert('Load Image:' + errorString);
                    }
                );
            }
        }
    </script>
</body>

</html>